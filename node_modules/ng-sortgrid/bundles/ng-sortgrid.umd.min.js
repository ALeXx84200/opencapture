!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@angular/common")):"function"==typeof define&&define.amd?define("ng-sortgrid",["exports","@angular/core","rxjs","rxjs/operators","@angular/common"],t):t((e=e||self)["ng-sortgrid"]={},e.ng.core,e.rxjs,e.rxjs.operators,e.ng.common)}(this,(function(e,t,r,o,n){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */Object.create;function s(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,n,s=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=s.next()).done;)i.push(o.value)}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return i}function i(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e}Object.create;var c=function(){function e(){}return e.findIndex=function(e){var t=e.parentNode.children;return Array.prototype.indexOf.call(t,e)},e}();var d=function(){function e(e){this.document=e,this.DEFAULT_SCROLLSPEED=50,this.SCROLL_BUFFER=50,this.window=e.defaultView}return e.prototype.scrollIfNecessary=function(e,t,r){void 0===t&&(t={});var o=e.pageY-this.window.scrollY;this.isTopScrollNeeded(o,t.top)?this.window.scrollBy({top:-r||-this.DEFAULT_SCROLLSPEED,behavior:"smooth"}):this.isBottomScrollNeeded(o,t.bottom)&&this.window.scrollBy({top:r||this.DEFAULT_SCROLLSPEED,behavior:"smooth"})},e.prototype.isTopScrollNeeded=function(e,t){return t?e<t:e<this.SCROLL_BUFFER},e.prototype.isBottomScrollNeeded=function(e,t){return t?e>t:e>this.window.innerHeight-this.SCROLL_BUFFER},e}();d.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],d.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[n.DOCUMENT]}]}]},d.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new d(t.ɵɵinject(n.DOCUMENT))},token:d,providedIn:"root"});var a=function(){function e(){this.SELECTED_DEFAULT_CLASS="ng-sg-selected",this.PLACEHOLDER_DEFAULT_CLASS="ng-sg-placeholder",this.DROPPED_DEFAULT_CLASS="ng-sg-dropped"}return e.prototype.addPlaceHolderClass=function(e){e.classList.add(this.PLACEHOLDER_DEFAULT_CLASS)},e.prototype.removePlaceHolderClass=function(e){e.classList.remove(this.PLACEHOLDER_DEFAULT_CLASS)},e.prototype.addDroppedClass=function(e){e.classList.add(this.DROPPED_DEFAULT_CLASS)},e.prototype.removeDroppedClass=function(e){e.classList.remove(this.DROPPED_DEFAULT_CLASS)},e.prototype.addSelectedClass=function(e){e.classList.add(this.SELECTED_DEFAULT_CLASS)},e.prototype.removeSelectedClass=function(e){e.classList.remove(this.SELECTED_DEFAULT_CLASS)},e}();a.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],a.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new a},token:a,providedIn:"root"});var p=function(){function e(){this.state=new Map}return e.prototype.initState=function(e,t,r){void 0===t&&(t=[]),void 0===r&&(r={}),this.state.set(e,{items:i(t),classes:r,selectedItems:[]})},e.prototype.addSelectedItem=function(e,t){this.state.get(e).selectedItems.push(t)},e.prototype.removeSelectedItem=function(e,t){var r=this.state.get(e).selectedItems.filter((function(e){return e.node!==t}));this.setSelectedItems(e,r)},e.prototype.setItems=function(e,t){this.state.get(e).items=i(t)},e.prototype.getItems=function(e){return this.state.get(e).items},e.prototype.hasItems=function(e){return this.getItems(e).length>0},e.prototype.hasGroup=function(e){return this.state.has(e)},e.prototype.getSelectedItems=function(e){return this.state.get(e).selectedItems},e.prototype.setSelectedItems=function(e,t){this.state.get(e).selectedItems=i(t)},e.prototype.getFirstSelectItem=function(e){return this.state.get(e).selectedItems[0]},e.prototype.hasSelectedItems=function(e){return this.getSelectedItems(e).length>0},e.prototype.resetSelectedItems=function(e){this.setSelectedItems(e,[])},e.prototype.getClasses=function(e){return this.state.get(e).classes},e}();p.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],p.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new p},token:p,providedIn:"root"});var l={ADD:0,REMOVE:1};l[l.ADD]="ADD",l[l.REMOVE]="REMOVE";var u=function(){function e(e,t){var n=this;this.classService=e,this.ngsgStore=t,this.COMMAND_KEY="Meta",this.CONTROL_KEY="Control",this.selectionChange$=new r.Subject;var i=this.selectionKeyPressed();this.selectionChange$.pipe(o.withLatestFrom(i)).subscribe((function(e){var t=s(e,2),r=t[0];t[1]?n.handleSelectionChange(r):n.resetSelectedItems(r.key)}))}return e.prototype.resetSelectedItems=function(e){var t=this;this.ngsgStore.getSelectedItems(e).forEach((function(e){return t.classService.removeSelectedClass(e.node)})),this.ngsgStore.resetSelectedItems(e)},e.prototype.handleSelectionChange=function(e){e.action===l.ADD&&(this.classService.addSelectedClass(e.item),this.ngsgStore.addSelectedItem(e.key,{node:e.item,originalIndex:c.findIndex(e.item)})),e.action===l.REMOVE&&(this.classService.removeSelectedClass(e.item),this.ngsgStore.removeSelectedItem(e.key,e.item))},e.prototype.selectionKeyPressed=function(){var e=this,t=r.fromEvent(window,"keydown").pipe(o.filter((function(t){return t.key===e.COMMAND_KEY||t.key===e.CONTROL_KEY})),o.mapTo(!0)),n=r.fromEvent(window,"keyup").pipe(o.mapTo(!1));return r.merge(t,n)},e.prototype.selectElementIfNoSelection=function(e,t){this.ngsgStore.hasSelectedItems(e)||this.ngsgStore.addSelectedItem(e,{node:t,originalIndex:c.findIndex(t)})},e.prototype.updateSelectedDragItem=function(e,t,r){this.selectionChange$.next({key:e,item:t,action:r?l.ADD:l.REMOVE})},e}();u.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],u.ctorParameters=function(){return[{type:a},{type:p}]},u.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new u(t.ɵɵinject(a),t.ɵɵinject(p))},token:u,providedIn:"root"});var g=function(){this.dropped$=new r.Subject};g.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],g.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new g},token:g,providedIn:"root"});var h=function(){function e(e){this.ngsgStore=e}return e.prototype.reflectChanges=function(e,t){for(var r=this.ngsgStore.getItems(e),o=this.ngsgStore.getSelectedItems(e),n=this.getSelectedElementsIndices(o),s=this.getSelectedItems(r,n),i=n.sort(),c=this.findDropIndex(o,t);i.length>0;)r.splice(i.pop(),1);var d=this.getReflectedItems(r,s,c);return this.ngsgStore.setItems(e,d),d},e.prototype.getReflectedItems=function(e,t,r){return i(e.slice(0,r),t,e.slice(r,e.length))},e.prototype.getSelectedItems=function(e,t){var r=[];return t.forEach((function(t){r.push(e[t])})),r},e.prototype.getSelectedElementsIndices=function(e){return e.map((function(e){return e.originalIndex}))},e.prototype.findDropIndex=function(e,t){return this.isDropInSelection(e,t)?c.findIndex(e[0].node):c.findIndex(t)},e.prototype.isDropInSelection=function(e,t){return!!e.find((function(e){return e.node===t}))},e}();h.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],h.ctorParameters=function(){return[{type:p}]},h.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new h(t.ɵɵinject(p))},token:h,providedIn:"root"});var f=function(){function e(e,t){this.classService=e,this.ngsgStore=t}return e.prototype.initSort=function(e){this.dragIndex=this.ngsgStore.getFirstSelectItem(e).originalIndex,this.dragElements=this.ngsgStore.getSelectedItems(e)},e.prototype.sort=function(e){var t=this,r=c.findIndex(e),o=this.getSibling(e,this.dragIndex,r);this.isDropInSelection(o)||(this.dragElements.forEach((function(r){var n=e.parentNode.insertBefore(r.node,o.node);t.classService.addPlaceHolderClass(n)})),this.dragIndex=c.findIndex(this.dragElements[0].node))},e.prototype.endSort=function(){var e=this;this.dragElements.forEach((function(t){e.updateDropedItem(t.node)}))},e.prototype.getSibling=function(e,t,r){return t<r?{node:e.nextSibling,originalIndex:r+1}:{node:e,originalIndex:r}},e.prototype.isDropInSelection=function(e){return!!this.dragElements.find((function(t){return t.node===e.node}))},e.prototype.updateDropedItem=function(e){var t=this;this.classService.removePlaceHolderClass(e),this.classService.addDroppedClass(e),this.classService.removeSelectedClass(e),r.timer(500).subscribe((function(){return t.classService.removeDroppedClass(e)}))},e}();f.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],f.ctorParameters=function(){return[{type:a},{type:p}]},f.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new f(t.ɵɵinject(a),t.ɵɵinject(p))},token:f,providedIn:"root"});var S="[ngSortgridItem]",m=function(){function e(e,o,n,s,i,c,d){this.el=e,this.sortService=o,this.selectionService=n,this.reflectService=s,this.ngsgStore=i,this.ngsgEventService=c,this.scrollHelperService=d,this.ngSortGridGroup="defaultGroup",this.autoScroll=!1,this.sorted=new t.EventEmitter,this.selected=!1,this.destroy$=new r.Subject}return e.prototype.ngOnInit=function(){var e=this;this.ngsgEventService.dropped$.pipe(o.takeUntil(this.destroy$)).subscribe((function(){return e.selected=!1})),r.fromEvent(this.el.nativeElement,"drag").pipe(o.throttleTime(20),o.takeUntil(this.destroy$),o.takeWhile((function(){return e.autoScroll}))).subscribe((function(){e.scrollHelperService.scrollIfNecessary(event,{top:e.scrollPointTop,bottom:e.scrollPointBottom},e.scrollSpeed)}))},e.prototype.ngOnChanges=function(e){var t=e.ngSortGridItems,r=t.currentValue?t.currentValue:[];this.ngsgStore.hasGroup(this.ngSortGridGroup)?this.ngsgStore.setItems(this.ngSortGridGroup,r):this.ngsgStore.initState(this.ngSortGridGroup,r)},e.prototype.ngAfterViewInit=function(){this.el.nativeElement.draggable=!0},e.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete()},e.prototype.dragStart=function(e){this.occuredOnHost(e)&&(this.selectionService.selectElementIfNoSelection(this.ngSortGridGroup,e.target),this.sortService.initSort(this.ngSortGridGroup))},e.prototype.dragEnter=function(){this.ngsgStore.hasSelectedItems(this.ngSortGridGroup)&&this.sortService.sort(this.el.nativeElement)},e.prototype.dragOver=function(e){return e.preventDefault&&e.preventDefault(),!1},e.prototype.drop=function(){if(this.ngsgStore.hasSelectedItems(this.ngSortGridGroup))if(this.ngsgStore.hasItems(this.ngSortGridGroup)){var e=i(this.ngsgStore.getItems(this.ngSortGridGroup));this.sortService.endSort();var t=this.reflectService.reflectChanges(this.ngSortGridGroup,this.el.nativeElement);this.sorted.next({previousOrder:e,currentOrder:t}),this.ngsgStore.resetSelectedItems(this.ngSortGridGroup),this.ngsgEventService.dropped$.next()}else console.warn("Ng-sortgrid: No items provided - please use [sortGridItems] to pass in an array of items -\n      otherwhise the ordered items can not be emitted in the (sorted) event")},e.prototype.clicked=function(){this.selected=!this.isItemCurrentlySelected(),this.selectionService.updateSelectedDragItem(this.ngSortGridGroup,this.el.nativeElement,this.selected)},e.prototype.isItemCurrentlySelected=function(){var e=c.findIndex(this.el.nativeElement);return!!this.ngsgStore.getSelectedItems(this.ngSortGridGroup).find((function(t){return t.originalIndex===e}))},e.prototype.occuredOnHost=function(e){return e.target.matches(S)},e}();m.decorators=[{type:t.Directive,args:[{selector:S}]}],m.ctorParameters=function(){return[{type:t.ElementRef},{type:f},{type:u},{type:h},{type:p},{type:g},{type:d}]},m.propDecorators={ngSortGridGroup:[{type:t.Input}],ngSortGridItems:[{type:t.Input}],scrollPointTop:[{type:t.Input}],scrollPointBottom:[{type:t.Input}],scrollSpeed:[{type:t.Input}],autoScroll:[{type:t.Input}],sorted:[{type:t.Output}],dragStart:[{type:t.HostListener,args:["dragstart",["$event"]]}],dragEnter:[{type:t.HostListener,args:["dragenter"]}],dragOver:[{type:t.HostListener,args:["dragover",["$event"]]}],drop:[{type:t.HostListener,args:["dragend"]}],clicked:[{type:t.HostListener,args:["click"]}]};var y=function(){};y.decorators=[{type:t.NgModule,args:[{declarations:[m],exports:[m]}]}],e.NgsgItemDirective=m,e.NgsgModule=y,e.ɵa=f,e.ɵb=a,e.ɵc=p,e.ɵd=u,e.ɵe=h,e.ɵf=g,e.ɵg=d,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ng-sortgrid.umd.min.js.map