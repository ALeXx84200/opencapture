{"version":3,"sources":["../../../node_modules/tslib/tslib.es6.js","../../../projects/ng-sortgrid/src/lib/helpers/element/ngsg-elements.helper.ts","../../../projects/ng-sortgrid/src/lib/helpers/scroll/scroll-helper.service.ts","../../../projects/ng-sortgrid/src/lib/helpers/class/ngsg-class.service.ts","../../../projects/ng-sortgrid/src/lib/store/ngsg-store.service.ts","../../../projects/ng-sortgrid/src/lib/mutliselect/ngsg-selection.service.ts","../../../projects/ng-sortgrid/src/lib/shared/ngsg-events.service.ts","../../../projects/ng-sortgrid/src/lib/sort/reflection/ngsg-reflect.service.ts","../../../projects/ng-sortgrid/src/lib/sort/sort/ngsg-sort.service.ts","../../../projects/ng-sortgrid/src/lib/ngsg-item.directive.ts","../../../projects/ng-sortgrid/src/lib/ngsg.module.ts"],"names":["Object","create","__read","o","n","m","Symbol","iterator","r","e","i","call","ar","next","done","push","value","error","__spread","arguments","length","concat","NgsgElementsHelper","findIndex","element","allElements","parentNode","children","Array","prototype","indexOf","ScrollHelperService","document","this","DEFAULT_SCROLLSPEED","SCROLL_BUFFER","window","defaultView","scrollIfNecessary","event","scrollPoints","scrollSpeed","currentPosition","pageY","scrollY","isTopScrollNeeded","top","scrollBy","behavior","isBottomScrollNeeded","bottom","scrollPointTop","scrollPointBottom","innerHeight","Injectable","args","providedIn","Inject","DOCUMENT","NgsgClassService","SELECTED_DEFAULT_CLASS","PLACEHOLDER_DEFAULT_CLASS","DROPPED_DEFAULT_CLASS","addPlaceHolderClass","classList","add","removePlaceHolderClass","remove","addDroppedClass","removeDroppedClass","addSelectedClass","removeSelectedClass","NgsgStoreService","state","Map","initState","group","items","classes","set","selectedItems","addSelectedItem","dragElement","get","removeSelectedItem","item","updatedItems","filter","node","setSelectedItems","setItems","getItems","hasItems","hasGroup","has","getSelectedItems","getFirstSelectItem","hasSelectedItems","resetSelectedItems","getClasses","ChangeAction","ADD","REMOVE","NgsgSelectionService","classService","ngsgStore","_this","COMMAND_KEY","CONTROL_KEY","selectionChange$","Subject","selectionKeyPressed$","selectionKeyPressed","pipe","withLatestFrom","subscribe","_a","_b","selectionChange","handleSelectionChange","key","forEach","action","originalIndex","fromEvent","keyboardEvent","mapTo","keyup","merge","selectElementIfNoSelection","dragedElement","updateSelectedDragItem","selected","dropped$","NgsgReflectService","reflectChanges","selectedElements","selectedElementIndices","getSelectedElementsIndices","sortedIndices","sort","dropIndex","findDropIndex","splice","pop","result","getReflectedItems","slice","selectedElementIndexes","index","map","selectedElement","isDropInSelection","collection","dropElement","find","dragElment","NgsgSortService","initSort","dragIndex","dragElements","hoverIndex","el","getSibling","insertedNode","insertBefore","endSort","updateDropedItem","nextSibling","timer","selector","NgsgItemDirective","sortService","selectionService","reflectService","ngsgEventService","scrollHelperService","ngSortGridGroup","autoScroll","sorted","EventEmitter","destroy$","ngOnInit","takeUntil","nativeElement","throttleTime","takeWhile","ngOnChanges","changes","sortGridItemChanges","ngSortGridItems","sortGridItems","currentValue","ngAfterViewInit","draggable","ngOnDestroy","complete","dragStart","occuredOnHost","target","dragEnter","dragOver","preventDefault","drop","previousOrder","currentOrder","console","warn","clicked","isItemCurrentlySelected","matches","Directive","ElementRef","NgsgEventsService","Input","Output","HostListener","NgModule","declarations","exports"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","export class NgsgElementsHelper {\n\n  public static findIndex(element: Element): number {\n    const allElements = element.parentNode.children;\n    return Array.prototype.indexOf.call(allElements, element);\n  }\n}\n","import {DOCUMENT} from '@angular/common';\nimport {Inject, Injectable} from '@angular/core';\n\nexport interface ScrollPoints {\n  top?: number;\n  bottom?: number;\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ScrollHelperService {\n\n  private window: WindowProxy;\n  private DEFAULT_SCROLLSPEED = 50;\n  private SCROLL_BUFFER = 50;\n\n  constructor(@Inject(DOCUMENT) private document) {\n    this.window = document.defaultView;\n  }\n\n  public scrollIfNecessary(event: any, scrollPoints: ScrollPoints = {}, scrollSpeed?: number): void {\n    const currentPosition = event.pageY - this.window.scrollY;\n\n    if (this.isTopScrollNeeded(currentPosition, scrollPoints.top)) {\n      this.window.scrollBy({top: -scrollSpeed || -this.DEFAULT_SCROLLSPEED, behavior: 'smooth'});\n      return;\n    }\n\n    if (this.isBottomScrollNeeded(currentPosition, scrollPoints.bottom)) {\n      this.window.scrollBy({top: scrollSpeed || this.DEFAULT_SCROLLSPEED, behavior: 'smooth'});\n    }\n  }\n\n  private isTopScrollNeeded(currentPosition: number, scrollPointTop: number): boolean {\n    return scrollPointTop ? currentPosition < scrollPointTop :\n      currentPosition < this.SCROLL_BUFFER;\n  }\n\n  private isBottomScrollNeeded(currentPosition: number, scrollPointBottom: number): boolean {\n    return scrollPointBottom ? currentPosition > scrollPointBottom :\n      currentPosition > this.window.innerHeight - this.SCROLL_BUFFER;\n  }\n}\n","import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NgsgClassService {\n  private SELECTED_DEFAULT_CLASS = 'ng-sg-selected';\n  private PLACEHOLDER_DEFAULT_CLASS = 'ng-sg-placeholder';\n  private DROPPED_DEFAULT_CLASS = 'ng-sg-dropped';\n\n  public addPlaceHolderClass(element: Element): void {\n    element.classList.add(this.PLACEHOLDER_DEFAULT_CLASS);\n  }\n\n  public removePlaceHolderClass(element: Element): void {\n    element.classList.remove(this.PLACEHOLDER_DEFAULT_CLASS);\n  }\n\n  public addDroppedClass(element: Element): void {\n    element.classList.add(this.DROPPED_DEFAULT_CLASS);\n  }\n\n  public removeDroppedClass(element: Element): void {\n    element.classList.remove(this.DROPPED_DEFAULT_CLASS);\n  }\n\n  public addSelectedClass(element: Element): void {\n    element.classList.add(this.SELECTED_DEFAULT_CLASS);\n  }\n\n  public removeSelectedClass(element: Element): void {\n    element.classList.remove(this.SELECTED_DEFAULT_CLASS);\n  }\n\n}\n","import {Injectable} from '@angular/core';\n\nimport {NgsgDragelement} from '../shared/ngsg-dragelement.model';\n\n// TODO add interfaces for classes\nexport interface NgsgState {\n  items: any[];\n  classes: any;\n  selectedItems: NgsgDragelement[];\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NgsgStoreService {\n  private state = new Map<string, NgsgState>();\n\n  public initState(group: string, items: any[] = [], classes: any = {}): void {\n    this.state.set(group, {items: [...items], classes, selectedItems: []});\n  }\n\n  public addSelectedItem(group: string, dragElement: NgsgDragelement): void {\n    this.state.get(group).selectedItems.push(dragElement);\n  }\n\n  public removeSelectedItem(group: string, item: Element): void {\n    const updatedItems = this.state.get(group).selectedItems\n      .filter((dragElement: NgsgDragelement) => dragElement.node !== item);\n    this.setSelectedItems(group, updatedItems);\n  }\n\n  public setItems(group: string, items: any): void {\n    this.state.get(group).items = [...items];\n  }\n\n  public getItems(group: string): any[] {\n    return this.state.get(group).items;\n  }\n\n  public hasItems(group: string): boolean {\n    return this.getItems(group).length > 0;\n  }\n\n  public hasGroup(group: string): boolean {\n    return this.state.has(group);\n  }\n\n  public getSelectedItems(group: string): NgsgDragelement[] {\n    return this.state.get(group).selectedItems;\n  }\n\n  public setSelectedItems(group: string, selectedItems: any[]): void {\n    this.state.get(group).selectedItems = [...selectedItems];\n  }\n\n  public getFirstSelectItem(group: string): NgsgDragelement {\n    return this.state.get(group).selectedItems[0];\n  }\n\n  public hasSelectedItems(group: string): boolean {\n    return this.getSelectedItems(group).length > 0;\n  }\n\n  public resetSelectedItems(group: string): void {\n    this.setSelectedItems(group, []);\n  }\n\n  public getClasses(group: string): any[] {\n    return this.state.get(group).classes;\n  }\n}\n","import {Injectable} from '@angular/core';\nimport {fromEvent, merge, NEVER, Observable, Subject} from 'rxjs';\nimport {filter, mapTo, switchMap, withLatestFrom} from 'rxjs/operators';\n\nimport {NgsgClassService} from '../helpers/class/ngsg-class.service';\nimport {NgsgElementsHelper} from '../helpers/element/ngsg-elements.helper';\nimport {NgsgStoreService} from '../store/ngsg-store.service';\n\nenum ChangeAction {\n  ADD,\n  REMOVE\n}\n\ninterface SelectionChange {\n  key: string;\n  item: Element;\n  action: ChangeAction;\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NgsgSelectionService {\n  private COMMAND_KEY = 'Meta';\n  private CONTROL_KEY = 'Control';\n\n  private selectionChange$ = new Subject<SelectionChange>();\n\n  constructor(private classService: NgsgClassService, private ngsgStore: NgsgStoreService) {\n    const selectionKeyPressed$ = this.selectionKeyPressed();\n    this.selectionChange$\n      .pipe(withLatestFrom(selectionKeyPressed$))\n      .subscribe(([selectionChange, selectionKeyPressed]) => {\n        selectionKeyPressed\n          ? this.handleSelectionChange(selectionChange)\n          : this.resetSelectedItems(selectionChange.key);\n      });\n  }\n\n  private resetSelectedItems(group: string): void {\n    this.ngsgStore.getSelectedItems(group).forEach(item => this.classService.removeSelectedClass(item.node));\n    this.ngsgStore.resetSelectedItems(group);\n  }\n\n  private handleSelectionChange(selectionChange: SelectionChange): void {\n    if (selectionChange.action === ChangeAction.ADD) {\n      this.classService.addSelectedClass(selectionChange.item);\n      this.ngsgStore.addSelectedItem(selectionChange.key, {\n        node: selectionChange.item,\n        originalIndex: NgsgElementsHelper.findIndex(selectionChange.item)\n      });\n    }\n    if (selectionChange.action === ChangeAction.REMOVE) {\n      this.classService.removeSelectedClass(selectionChange.item);\n      this.ngsgStore.removeSelectedItem(selectionChange.key, selectionChange.item);\n    }\n  }\n\n  private selectionKeyPressed(): Observable<boolean> {\n    const selectionKeyPressed = fromEvent(window, 'keydown').pipe(\n      filter(\n        (keyboardEvent: KeyboardEvent) =>\n          keyboardEvent.key === this.COMMAND_KEY || keyboardEvent.key === this.CONTROL_KEY\n      ),\n      mapTo(true)\n    );\n    const keyup = fromEvent(window, 'keyup').pipe(mapTo(false));\n    return merge(selectionKeyPressed, keyup);\n  }\n\n  public selectElementIfNoSelection(group: string, dragedElement: Element): void {\n    if (this.ngsgStore.hasSelectedItems(group)) {\n      return;\n    }\n    this.ngsgStore.addSelectedItem(group, {\n      node: dragedElement,\n      originalIndex: NgsgElementsHelper.findIndex(dragedElement)\n    });\n  }\n\n  public updateSelectedDragItem(key: string, item: Element, selected: boolean): void {\n    this.selectionChange$.next({\n      key,\n      item,\n      action: selected ? ChangeAction.ADD : ChangeAction.REMOVE\n    });\n  }\n}\n","import {Injectable} from '@angular/core';\nimport {Subject} from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NgsgEventsService {\n  public dropped$ = new Subject();\n}\n","import { Injectable } from '@angular/core';\n\nimport {NgsgElementsHelper} from '../../helpers/element/ngsg-elements.helper';\nimport {NgsgDragelement} from '../../shared/ngsg-dragelement.model';\nimport {NgsgStoreService} from '../../store/ngsg-store.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NgsgReflectService {\n  constructor(private ngsgStore: NgsgStoreService) {}\n\n  public reflectChanges(key: string, element: Element): any[] {\n    const items = this.ngsgStore.getItems(key);\n    const selectedElements = this.ngsgStore.getSelectedItems(key);\n    const selectedElementIndices = this.getSelectedElementsIndices(selectedElements);\n    const selectedItems = this.getSelectedItems(items, selectedElementIndices);\n    const sortedIndices = selectedElementIndices.sort();\n    const dropIndex = this.findDropIndex(selectedElements, element);\n\n    while (sortedIndices.length > 0) {\n      items.splice(sortedIndices.pop(), 1);\n    }\n\n    const result = this.getReflectedItems(items, selectedItems, dropIndex);\n    this.ngsgStore.setItems(key, result);\n    return result;\n  }\n\n  private getReflectedItems(items: any, selectedItems: any, dropIndex: number): any[] {\n    const beforeSelection = items.slice(0, dropIndex);\n    const afterSelection = items.slice(dropIndex, items.length);\n    return [...beforeSelection, ...selectedItems, ...afterSelection];\n  }\n\n  private getSelectedItems(items: any[], selectedElementIndexes: number[]): any[] {\n    const selectedItems = [];\n    selectedElementIndexes.forEach(index => {\n      selectedItems.push(items[index]);\n    });\n    return selectedItems;\n  }\n\n  private getSelectedElementsIndices(selectedElements: NgsgDragelement[]): number[] {\n    return selectedElements.map((selectedElement: NgsgDragelement) => selectedElement.originalIndex);\n  }\n\n  private findDropIndex(selectedElements: NgsgDragelement[], element: Element): number {\n    if (this.isDropInSelection(selectedElements, element)) {\n      return NgsgElementsHelper.findIndex(selectedElements[0].node);\n    }\n    return NgsgElementsHelper.findIndex(element);\n  }\n\n  private isDropInSelection(collection: NgsgDragelement[], dropElement: Element): boolean {\n    return !!collection.find((dragElment: NgsgDragelement) => dragElment.node === dropElement);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { timer } from 'rxjs';\n\nimport {NgsgClassService} from '../../helpers/class/ngsg-class.service';\nimport {NgsgElementsHelper} from '../../helpers/element/ngsg-elements.helper';\nimport {NgsgDragelement} from '../../shared/ngsg-dragelement.model';\nimport {NgsgStoreService} from '../../store/ngsg-store.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NgsgSortService {\n  private dragIndex: number;\n  private dragElements: NgsgDragelement[];\n\n  constructor(\n    private classService: NgsgClassService,\n    private ngsgStore: NgsgStoreService\n  ) {}\n\n  public initSort(group: string): void {\n    this.dragIndex = this.ngsgStore.getFirstSelectItem(group).originalIndex;\n    this.dragElements = this.ngsgStore.getSelectedItems(group);\n  }\n\n  public sort(dropElement: Element): void {\n    const hoverIndex = NgsgElementsHelper.findIndex(dropElement);\n    const el = this.getSibling(dropElement, this.dragIndex, hoverIndex);\n\n    if (this.isDropInSelection(el)) {\n      return;\n    }\n    this.dragElements.forEach((dragElement: NgsgDragelement) => {\n      const insertedNode = dropElement.parentNode.insertBefore(dragElement.node, el.node);\n      this.classService.addPlaceHolderClass(insertedNode as Element);\n    });\n    this.dragIndex = NgsgElementsHelper.findIndex(this.dragElements[0].node);\n  }\n\n  public endSort(): void {\n    this.dragElements.forEach((dragElement: NgsgDragelement) => {\n      this.updateDropedItem(dragElement.node);\n    });\n  }\n\n  private getSibling(dropElement: any, dragIndex: number, hoverIndex: number): NgsgDragelement | null {\n    if (dragIndex < hoverIndex) {\n      return { node: dropElement.nextSibling, originalIndex: hoverIndex + 1 };\n    }\n    return { node: dropElement, originalIndex: hoverIndex };\n  }\n\n  private isDropInSelection(dropElement: NgsgDragelement): boolean {\n    return !!this.dragElements.find((dragElment: NgsgDragelement) => dragElment.node === dropElement.node);\n  }\n\n  private updateDropedItem(item: Element): void {\n    this.classService.removePlaceHolderClass(item);\n    this.classService.addDroppedClass(item);\n    this.classService.removeSelectedClass(item);\n    timer(500).subscribe(() => this.classService.removeDroppedClass(item));\n  }\n}\n","import {\n  AfterViewInit,\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Input,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  Output,\n  SimpleChanges\n} from '@angular/core';\nimport {fromEvent, Subject} from 'rxjs';\nimport {takeUntil, takeWhile, throttleTime} from 'rxjs/operators';\n\nimport {NgsgElementsHelper} from './helpers/element/ngsg-elements.helper';\nimport {ScrollHelperService} from './helpers/scroll/scroll-helper.service';\nimport {NgsgSelectionService} from './mutliselect/ngsg-selection.service';\nimport {NgsgEventsService} from './shared/ngsg-events.service';\nimport {NgsgOrderChange} from './shared/ngsg-order-change.model';\nimport {NgsgReflectService} from './sort/reflection/ngsg-reflect.service';\nimport {NgsgSortService} from './sort/sort/ngsg-sort.service';\nimport {NgsgStoreService} from './store/ngsg-store.service';\n\nconst selector = '[ngSortgridItem]';\n\n@Directive({selector})\nexport class NgsgItemDirective implements OnInit, OnChanges, AfterViewInit, OnDestroy {\n  @Input() ngSortGridGroup = 'defaultGroup';\n  @Input() ngSortGridItems: any[];\n  @Input() scrollPointTop: number;\n  @Input() scrollPointBottom: number;\n  @Input() scrollSpeed: number;\n  @Input() autoScroll = false;\n\n  @Output() sorted = new EventEmitter<NgsgOrderChange<any>>();\n\n  private selected = false;\n  private destroy$ = new Subject();\n\n  constructor(\n    public el: ElementRef,\n    private sortService: NgsgSortService,\n    private selectionService: NgsgSelectionService,\n    private reflectService: NgsgReflectService,\n    private ngsgStore: NgsgStoreService,\n    private ngsgEventService: NgsgEventsService,\n    private scrollHelperService: ScrollHelperService\n  ) {\n  }\n\n  ngOnInit(): void {\n    this.ngsgEventService.dropped$.pipe(\n      takeUntil(this.destroy$)\n    ).subscribe(() => this.selected = false);\n\n    fromEvent<DragEvent>(this.el.nativeElement, 'drag').pipe(\n      throttleTime(20),\n      takeUntil(this.destroy$),\n      takeWhile(() => this.autoScroll)\n    ).subscribe(() => {\n        this.scrollHelperService.scrollIfNecessary(event, {\n          top: this.scrollPointTop,\n          bottom: this.scrollPointBottom\n        }, this.scrollSpeed);\n      }\n    );\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    const sortGridItemChanges = changes.ngSortGridItems;\n    const sortGridItems = sortGridItemChanges.currentValue ? sortGridItemChanges.currentValue : [];\n\n    if (!this.ngsgStore.hasGroup(this.ngSortGridGroup)) {\n      this.ngsgStore.initState(this.ngSortGridGroup, sortGridItems);\n      return;\n    }\n    this.ngsgStore.setItems(this.ngSortGridGroup, sortGridItems);\n  }\n\n  ngAfterViewInit(): void {\n    this.el.nativeElement.draggable = true;\n  }\n\n  ngOnDestroy(): void {\n    this.destroy$.next();\n    this.destroy$.complete();\n  }\n\n  @HostListener('dragstart', ['$event'])\n  dragStart(event): void {\n    if (!this.occuredOnHost(event)) {\n      return;\n    }\n    this.selectionService.selectElementIfNoSelection(this.ngSortGridGroup, event.target);\n    this.sortService.initSort(this.ngSortGridGroup);\n  }\n\n  @HostListener('dragenter')\n  dragEnter(): void {\n    if (!this.ngsgStore.hasSelectedItems(this.ngSortGridGroup)) {\n      return;\n    }\n    this.sortService.sort(this.el.nativeElement);\n  }\n\n  @HostListener('dragover', ['$event'])\n  dragOver(event): boolean {\n    if (event.preventDefault) {\n      // Necessary. Allows us to drop.\n      event.preventDefault();\n    }\n    return false;\n  }\n\n  @HostListener('dragend')\n  drop(): void {\n    if (!this.ngsgStore.hasSelectedItems(this.ngSortGridGroup)) {\n      return;\n    }\n\n    if (!this.ngsgStore.hasItems(this.ngSortGridGroup)) {\n      console.warn(`Ng-sortgrid: No items provided - please use [sortGridItems] to pass in an array of items -\n      otherwhise the ordered items can not be emitted in the (sorted) event`);\n      return;\n    }\n    const previousOrder = [...this.ngsgStore.getItems(this.ngSortGridGroup)];\n    this.sortService.endSort();\n    const currentOrder = this.reflectService.reflectChanges(this.ngSortGridGroup, this.el.nativeElement);\n    this.sorted.next({previousOrder, currentOrder});\n    this.ngsgStore.resetSelectedItems(this.ngSortGridGroup);\n    this.ngsgEventService.dropped$.next();\n  }\n\n  @HostListener('click')\n  clicked(): void {\n    this.selected = !this.isItemCurrentlySelected();\n    this.selectionService.updateSelectedDragItem(this.ngSortGridGroup, this.el.nativeElement, this.selected);\n  }\n\n  private isItemCurrentlySelected(): boolean {\n    const index = NgsgElementsHelper.findIndex(this.el.nativeElement);\n    return !!this.ngsgStore.getSelectedItems(this.ngSortGridGroup)\n      .find(element => element.originalIndex === index);\n  }\n\n  private occuredOnHost(event): boolean {\n    return event.target.matches(selector);\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { NgsgItemDirective } from './ngsg-item.directive';\n\n@NgModule({\n  declarations: [NgsgItemDirective],\n  exports: [NgsgItemDirective]\n})\nexport class NgsgModule {}\n"]}